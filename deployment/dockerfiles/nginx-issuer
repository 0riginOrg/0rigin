FROM openresty/openresty:alpine-fat

ENV AUTO_SSL_VERSION='0.11.1' \
    LETSENCRYPT_URL='https://acme-v01.api.letsencrypt.org/directory'

RUN apk --no-cache add bash openssl \
    && /usr/local/openresty/luajit/bin/luarocks install lua-resty-auto-ssl $AUTO_SSL_VERSION \
    # Remove nginx default config
    && rm /etc/nginx/conf.d/default.conf

COPY nginx.conf snippets /usr/local/openresty/nginx/conf/

COPY scripts/nginx-issuer-entrypoint.sh /entrypoint.sh
