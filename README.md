# Origin Develop

Development stack for Origin Protocol. You can read more about Origin Protocol at https://www.originprotocol.com/. This is not an official part of the Origin Protocol codebase, it is an alternative to [origin-box](https://github.com/OriginProtocol/origin-box) that uses separate containers.

## Getting started

1. Clone this repository

2. Run `./install.sh`

You should now have a functioning development stack. The origin-dapp example application will be available if you point your browser to http://localhost:3000.

The install script will clone the origin repositories into subdirectories and checkout the develop branch. You can then develop and use them as normal git repositories.

If the install script doesn't complete the most likely reason is you don't have the [required ports](#port-errors) open. You can run `./install.sh -v` to see the output of the build process to diagnose the error.

![install.sh](https://github.com/tomlinton/origin-develop/raw/master/screenshot.png)

## Configuration

Configuration files reside in the `envfiles` directory. They are mounted into the relevant docker container when it is started. Modifications to these files will require a container restart (if the container was running).

The configuration should work out of the box. Certain components may require additional API keys for certain things to work. For example, origin-bridge needs some API keys for attestation services to work.

## Running tests

Test configurations are included in docker-compose-test.yml.

To test run tests for origin-js then use:

	docker-compose -f docker-compose-test.yml up origin-js-test

and similarly for origin-bridge:

	docker-compose -f docker-compose-test.yml up origin-bridge-test

## Data persistence

PostgreSQL data will persist through bringing the containers down and up again through the use of a mounted volume. To disable this comment out the volume lines in docker-compose.yml under the `postgres` service.

No persistence is in place for Redis data.

## Developer responsibilities

The environment purposefully doesn't include too much magic. We leave certain things to the developer.

### Database migrations

Database migrations are not run automatically. To create a migration:

	docker exec -ti origin-bridge /bin/bash -c "flask db migrate"

and to upgrade versions:

	docker exec -ti origin-bridge /bin/bash -c "flask db upgrade"

### Package management

Packages are installed during the Docker build process. If you modify the packages for a project (i.e. anything that results in a change to package.json or requirements.txt) you may need to add any missing packages to the container. The best way to do this is to rebuild the container.

E.g. to rebuild the origin-js container:

	docker-compose build --no-cache origin-js

## Handy commands

Spawn a shell in a container:

	docker exec -ti <container_name> /bin/bash

Connect to the origin_bridge postgresql database:

	docker exec -ti postgres /bin/bash -c "psql -h localhost -U origin origin_bridge"

Connect to redis:

	docker exec -ti redis /bin/bash -c "redis-cli"

## Troubleshooting

### Port errors

The environment requires a number of ports to be free on your machine (3000, 5000, 5002, 8080, 8081 and 8545). If one of these ports isn't available spinning up the development environment may fail.

### Metamask errors

Somethings Metamask gets confused on private networks. If you see errors generated by Metamask in your console while developing then opening Settings > Reset Account in Metamask should resolve the issue.
